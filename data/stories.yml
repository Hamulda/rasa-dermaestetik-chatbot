version: "3.1"

stories:

# ==============================================================================
# POZNÁMKA: Kde jsou všechny FAQ příběhy?
#
# Jednoduché interakce (intent -> odpověď) jsou nyní řešeny pomocí
# pravidel v souboru `rules.yml`. Je to efektivnější a spolehlivější.
# Tento soubor se soustředí pouze na komplexní, vícekrokové konverzace.
# ==============================================================================

- story: Pozdrav a navazující konverzace
  steps:
  - intent: greet
  - action: utter_greet
  - checkpoint: after_greet

- story: Šťastná cesta po pozdravu
  steps:
  - checkpoint: after_greet
  - intent: mood_great
  - action: utter_happy
  - action: utter_anything_else

- story: Smutná cesta s nápravou po pozdravu
  steps:
  - checkpoint: after_greet
  - intent: mood_unhappy
  - action: utter_cheer_up
  - action: utter_did_that_help
  - intent: affirm
  - action: utter_happy
  - action: utter_anything_else

- story: Smutná cesta bez nápravy po pozdravu
  steps:
  - checkpoint: after_greet
  - intent: mood_unhappy
  - action: utter_cheer_up
  - action: utter_did_that_help
  - intent: deny
  - action: utter_goodbye

- story: Identifikace bota
  steps:
  - intent: bot_challenge
  - action: utter_iamabot

# ==============================================================================
# HLAVNÍ SCÉNÁŘ PRO DOPORUČENÍ PRODUKTU ("ZLATÁ CESTA")
# ==============================================================================

- story: Formulář - základní úspěšná cesta
  steps:
  - intent: ask_product_recommendation
  - action: product_recommendation_form
  - active_loop: product_recommendation_form
  - slot_was_set:
    - requested_slot: skin_type
  - intent: inform
    entities:
    - skin_type: "suchá"
  - slot_was_set:
    - skin_type: ["suchá"]
  - action: product_recommendation_form
  - active_loop: product_recommendation_form
  - slot_was_set:
    - requested_slot: skin_concern
  - intent: inform
    entities:
    - skin_concern: "vrásky"
  - slot_was_set:
    - skin_concern: ["vrásky"]
  - action: product_recommendation_form
  - active_loop: null
  - action: utter_submit_form
  - action: action_recommend_product
  - checkpoint: recommendation_given

# ==============================================================================
# VARIANTY SPUŠTĚNÍ A VYPLNĚNÍ FORMULÁŘE
# ==============================================================================

- story: Formulář - uživatel poskytne všechny informace najednou
  steps:
  - intent: inform
    entities:
    - skin_type: "mastná"
    - skin_concern: "póry"
  - action: product_recommendation_form
  - active_loop: product_recommendation_form
  - action: product_recommendation_form # Rasa si uvědomí, že má vše a formulář ukončí
  - active_loop: null
  - action: utter_submit_form
  - action: action_recommend_product
  - checkpoint: recommendation_given

# ==============================================================================
# PŘERUŠENÍ KONVERZACE (DIGRESSIONS)
# ==============================================================================

- story: Formulář - přerušení a návrat
  steps:
  - intent: ask_product_recommendation
  - action: product_recommendation_form
  - active_loop: product_recommendation_form
  - intent: bot_challenge # Používáme běžný intent pro ukázku odbočení
  - action: utter_iamabot
  - action: product_recommendation_form # Bot se aktivně vrátí k formuláři
  - active_loop: product_recommendation_form

- story: Formulář - zrušení uživatelem
  steps:
  - intent: ask_product_recommendation
  - action: product_recommendation_form
  - active_loop: product_recommendation_form
  - intent: stop_form
  - action: action_deactivate_loop
  - active_loop: null
  - action: utter_form_cancelled
  - action: utter_anything_else

# ==============================================================================
# AKCE PO DOPORUČENÍ (POUŽITÍ CHECKPOINTU)
# ==============================================================================

- story: Uživatel chce změnit řazení po doporučení
  steps:
  - checkpoint: recommendation_given
  - intent: set_sort_preference
    entities:
    - sort_preference: "price_desc"
  - action: action_recommend_product
  - action: utter_anything_else

- story: Uživatel chce jiné doporučení po odmítnutí
  steps:
  - checkpoint: recommendation_given
  - intent: deny
  - action: utter_please_rephrase
  - action: product_recommendation_form
  - active_loop: product_recommendation_form
